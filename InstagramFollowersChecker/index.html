<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IG Follow Back Checker</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons (Inline SVGs for simplicity & reliability) ---
        const UploadIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
        );
        const CheckIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-400"><polyline points="20 6 9 17 4 12"/></svg>
        );
        const UserXIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="18" x2="23" y1="8" y2="13"/><line x1="23" x2="18" y1="8" y2="13"/></svg>
        );
        const UserCheckIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><polyline points="17 11 19 13 23 9"/></svg>
        );
        const SearchIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="16.65"/></svg>
        );
        const CopyIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        );

        // --- Components ---

        const FileUploader = ({ label, onFileLoaded, fileName }) => {
            const handleFileChange = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const json = JSON.parse(e.target.result);
                        onFileLoaded(json, file.name);
                    } catch (error) {
                        alert("File JSON tidak valid!");
                    }
                };
                reader.readAsText(file);
            };

            return (
                <div className="flex flex-col gap-2 w-full">
                    <label className="text-sm font-semibold text-gray-300 ml-1">{label}</label>
                    <div className={`relative group border-2 border-dashed rounded-xl p-6 transition-all duration-300 ${fileName ? 'border-green-500/50 bg-green-500/10' : 'border-gray-600 hover:border-blue-500 hover:bg-gray-800'}`}>
                        <input 
                            type="file" 
                            accept=".json" 
                            onChange={handleFileChange} 
                            className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                        />
                        <div className="flex flex-col items-center justify-center text-center">
                            {fileName ? (
                                <>
                                    <div className="bg-green-500 text-white p-2 rounded-full mb-2 shadow-lg shadow-green-500/20">
                                        <CheckIcon />
                                    </div>
                                    <p className="text-sm font-medium text-green-300 truncate max-w-[200px]">{fileName}</p>
                                    <p className="text-xs text-green-400/60 mt-1">Klik untuk ganti</p>
                                </>
                            ) : (
                                <>
                                    <div className="text-gray-400 group-hover:text-blue-400 mb-2 transition-colors">
                                        <UploadIcon />
                                    </div>
                                    <p className="text-sm text-gray-400 font-medium group-hover:text-white">Upload JSON</p>
                                    <p className="text-xs text-gray-500 mt-1">drag & drop atau klik</p>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const ResultCard = ({ title, count, icon: Icon, active, onClick, colorClass }) => (
            <button 
                onClick={onClick}
                className={`flex items-center justify-between p-4 rounded-xl border transition-all duration-300 w-full ${active 
                    ? `bg-gray-800 border-${colorClass}-500 shadow-lg shadow-${colorClass}-500/20` 
                    : 'bg-gray-800/50 border-gray-700 hover:bg-gray-800 hover:border-gray-600'}`}
            >
                <div className="flex items-center gap-3">
                    <div className={`p-2 rounded-lg ${active ? `bg-${colorClass}-500/20 text-${colorClass}-400` : 'bg-gray-700 text-gray-400'}`}>
                        <Icon />
                    </div>
                    <div className="text-left">
                        <h3 className={`text-sm font-semibold ${active ? 'text-white' : 'text-gray-300'}`}>{title}</h3>
                        <p className="text-xs text-gray-500">Total Akun</p>
                    </div>
                </div>
                <span className={`text-2xl font-bold ${active ? `text-${colorClass}-400` : 'text-gray-400'}`}>
                    {count}
                </span>
            </button>
        );

        const App = () => {
            const [followersData, setFollowersData] = useState([]);
            const [followingData, setFollowingData] = useState([]);
            
            const [followersFileName, setFollowersFileName] = useState("");
            const [followingFileName, setFollowingFileName] = useState("");

            const [resultDontFollowBack, setResultDontFollowBack] = useState([]);
            const [resultFans, setResultFans] = useState([]);
            
            const [activeTab, setActiveTab] = useState(null); // 'dontFollowBack' | 'fans'
            const [searchQuery, setSearchQuery] = useState("");
            const [isAnalyzed, setIsAnalyzed] = useState(false);

            // Parser khusus untuk struktur file Instagram yang sering berubah
            const extractUsernames = (json, type) => {
                let usernames = [];
                
                try {
                    // Logic untuk Followers (biasanya Array langsung)
                    if (type === 'followers') {
                        // Cek format standard array of objects
                        if (Array.isArray(json)) {
                            usernames = json.map(item => item.string_list_data?.[0]?.value).filter(Boolean);
                        } 
                        // Cek format lama atau variasi object wrapper
                        else if (json.relationships_followers) {
                             usernames = json.relationships_followers.map(item => item.string_list_data?.[0]?.value).filter(Boolean);
                        }
                    } 
                    // Logic untuk Following (biasanya Object -> relationships_following)
                    else if (type === 'following') {
                        const list = json.relationships_following || json.friends || []; // Fallback ke 'friends' untuk data lama
                        usernames = list.map(item => {
                            // Prioritas 1: string_list_data value
                            if (item.string_list_data?.[0]?.value) return item.string_list_data[0].value;
                            // Prioritas 2: Title field (kadang username ada di title)
                            if (item.title) return item.title;
                            return null;
                        }).filter(Boolean);
                    }
                } catch (e) {
                    console.error("Error parsing JSON", e);
                }
                
                return usernames;
            };

            const handleAnalyze = () => {
                const followersSet = new Set(followersData);
                const followingSet = new Set(followingData);

                // Logic: Ada di Following tapi GAK ADA di Followers
                const dontFollowBack = followingData.filter(user => !followersSet.has(user));
                
                // Logic: Ada di Followers tapi GAK ADA di Following
                const fans = followersData.filter(user => !followingSet.has(user));

                setResultDontFollowBack(dontFollowBack);
                setResultFans(fans);
                setIsAnalyzed(true);
                setActiveTab('dontFollowBack'); // Default open tab
            };

            const resetData = () => {
                setFollowersData([]);
                setFollowingData([]);
                setFollowersFileName("");
                setFollowingFileName("");
                setIsAnalyzed(false);
                setActiveTab(null);
                setSearchQuery("");
            };

            const getFilteredList = () => {
                const list = activeTab === 'dontFollowBack' ? resultDontFollowBack : resultFans;
                if (!searchQuery) return list;
                return list.filter(u => u.toLowerCase().includes(searchQuery.toLowerCase()));
            };

            const copyToClipboard = () => {
                const list = getFilteredList();
                const text = list.join('\n');
                navigator.clipboard.writeText(text);
                alert("Daftar berhasil disalin!");
            };

            return (
                <div className="max-w-2xl mx-auto p-4 md:p-8">
                    {/* Header */}
                    <div className="text-center mb-10 mt-4">
                        <div className="inline-block p-3 rounded-2xl bg-gradient-to-br from-pink-500 to-orange-400 shadow-lg shadow-orange-500/20 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg>
                        </div>
                        <h1 className="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-orange-400">
                            IG Checking
                        </h1>
                        <p className="text-gray-400 mt-2 text-sm">Cek siapa yang fake friend dan siapa fans rahasia lu.</p>
                    </div>

                    {/* Upload Section */}
                    {!isAnalyzed ? (
                        <div className="glass rounded-2xl p-6 md:p-8 animate-fade-in">
                            <div className="flex flex-col md:flex-row gap-6 mb-8">
                                <FileUploader 
                                    label="Upload followers_1.json" 
                                    fileName={followersFileName}
                                    onFileLoaded={(json, name) => {
                                        setFollowersData(extractUsernames(json, 'followers'));
                                        setFollowersFileName(name);
                                    }}
                                />
                                <FileUploader 
                                    label="Upload following.json" 
                                    fileName={followingFileName}
                                    onFileLoaded={(json, name) => {
                                        setFollowingData(extractUsernames(json, 'following'));
                                        setFollowingFileName(name);
                                    }}
                                />
                            </div>

                            <button
                                onClick={handleAnalyze}
                                disabled={!followersFileName || !followingFileName}
                                className={`w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all duration-300 flex items-center justify-center gap-2
                                    ${(!followersFileName || !followingFileName) 
                                        ? 'bg-gray-800 text-gray-500 cursor-not-allowed' 
                                        : 'bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white shadow-blue-500/25 transform hover:scale-[1.02]'
                                    }`}
                            >
                                <SearchIcon />
                                Analisis Sekarang
                            </button>
                            
                            <div className="mt-6 text-xs text-center text-gray-500">
                                <p>Data diproses lokal di browser lu. Gak ada yang dikirim ke server.</p>
                            </div>
                        </div>
                    ) : (
                        // Results Section
                        <div className="animate-fade-in-up">
                            <div className="flex gap-4 mb-6">
                                <ResultCard 
                                    title="Gak Follback" 
                                    count={resultDontFollowBack.length} 
                                    icon={UserXIcon}
                                    active={activeTab === 'dontFollowBack'}
                                    onClick={() => setActiveTab('dontFollowBack')}
                                    colorClass="red"
                                />
                                <ResultCard 
                                    title="Fans Lu" 
                                    count={resultFans.length} 
                                    icon={UserCheckIcon}
                                    active={activeTab === 'fans'}
                                    onClick={() => setActiveTab('fans')}
                                    colorClass="green"
                                />
                            </div>

                            <div className="glass rounded-2xl p-6 min-h-[400px]">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-xl font-bold flex items-center gap-2">
                                        {activeTab === 'dontFollowBack' ? (
                                            <span className="text-red-400">Mereka Gak Follback üò§</span>
                                        ) : (
                                            <span className="text-green-400">Fans Setia Lu üòç</span>
                                        )}
                                    </h2>
                                    <button onClick={resetData} className="text-xs text-gray-400 hover:text-white underline">
                                        Reset File
                                    </button>
                                </div>

                                {/* Search Bar */}
                                <div className="relative mb-4">
                                    <input 
                                        type="text" 
                                        placeholder="Cari username..." 
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        className="w-full bg-gray-800/50 border border-gray-700 rounded-lg py-2 pl-10 pr-4 text-sm text-gray-200 focus:outline-none focus:border-blue-500"
                                    />
                                    <div className="absolute left-3 top-2.5 text-gray-500">
                                        <SearchIcon />
                                    </div>
                                    {getFilteredList().length > 0 && (
                                        <button 
                                            onClick={copyToClipboard}
                                            className="absolute right-2 top-1.5 p-1 text-gray-400 hover:text-blue-400 transition-colors"
                                            title="Copy List"
                                        >
                                            <CopyIcon />
                                        </button>
                                    )}
                                </div>

                                {/* List Display */}
                                <div className="overflow-y-auto max-h-[300px] pr-2 custom-scrollbar">
                                    {getFilteredList().length > 0 ? (
                                        <ul className="space-y-2">
                                            {getFilteredList().map((user, idx) => (
                                                <li key={idx} className="flex items-center justify-between p-3 rounded-lg bg-gray-800/30 hover:bg-gray-800 transition-colors border border-gray-700/50">
                                                    <div className="flex items-center gap-3">
                                                        <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-gray-700 to-gray-600 flex items-center justify-center text-xs font-bold text-gray-300">
                                                            {user.substring(0,2).toUpperCase()}
                                                        </div>
                                                        <a 
                                                            href={`https://instagram.com/${user}`} 
                                                            target="_blank" 
                                                            rel="noreferrer"
                                                            className="text-sm font-medium hover:text-blue-400 transition-colors"
                                                        >
                                                            {user}
                                                        </a>
                                                    </div>
                                                    <a 
                                                        href={`https://instagram.com/${user}`} 
                                                        target="_blank" 
                                                        rel="noreferrer"
                                                        className="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-md transition-colors"
                                                    >
                                                        Lihat
                                                    </a>
                                                </li>
                                            ))}
                                        </ul>
                                    ) : (
                                        <div className="flex flex-col items-center justify-center h-[200px] text-gray-500">
                                            <p>Tidak ada data ditemukan.</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    <footer className="mt-12 text-center text-gray-600 text-sm">
                        <p>&copy; {new Date().getFullYear()} IG Checking. Buat have fun aja ya bre.</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
